<html layout:decorate="~{global/layout}">
<div layout:fragment="content" class="mt-3">
    <div class="bg-blue-600 px-4 py-3 mb-2 flex justify-between">
        <h2 class="text-white " th:text="${post.title}"></h2>
        <p class="text-white" th:text="${'조회수 : ' + post.viewCount}"></p>
    </div>
    <div class="mx-3">
        <div class="card w-96 bg-base-100 border border-base-300 mt-3 w-full px-2">
            <div class="card-body">
                <div class="card-text whitespace-pre-line" th:text="${post.content}"></div>
                <div class="flex justify-end">
                    <div th:if="${post.modifyDate != null}"
                         class="flex justify-end badge badge-ghost dark:text-gray-300 p-2 text-start">
                        <div class="mr-2">modified at</div>
                        <div th:text="${#temporals.format(post.modifyDate, 'yyyy-MM-dd HH:mm')}"></div>
                    </div>
                </div>
                <div class="flex justify-end">
                    <div class="flex justify-end badge badge-ghost dark:text-gray-300 p-2 text-start">
                        <div class="mr-2">
                            <span th:if="${post.author != null}" th:text="${post.author.username}"></span>
                        </div>
                        <div>
                            <div th:text="${#temporals.format(post.createDate, 'yyyy-MM-dd HH:mm')}"></div>
                        </div>
                    </div>
                </div>
                <div class="my-3 flex justify-between">
                    <div>
                        <div>
                            <form method="post" class="like btn btn-sm btn-ghost"
                                  th:action="@{|/post/${post.id}/like|}">
                                <button type="submit" onclick="return confirm('추천 하시겠습니까?');">
                                    <i class="fa-regular fa-heart fa-xl"></i>
                                    <span class="badge rounded-pill bg-error"
                                          th:text="${#lists.size(post.voter)}"></span>
                                </button>
                            </form>
                            <form method="post" class="deleteLike btn btn-sm btn-ghost"
                                  th:action="@{|/post/${post.id}/cancelLike|}">
                                <input type="hidden" name="_method" value="DELETE">
                                <button type="submit" onclick="return confirm('추천을 취소 하시겠습니까?');">
                                    <i class="fa-solid fa-heart-crack fa-xl"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                    <div class="flex justify-colum">
                        <a th:href="@{|/post/modify/${post.id}|}" class="btn btn-outline btn-sm mr-3"
                           sec:authorize="isAuthenticated()"
                           th:if="${post.author != null and #authentication.getPrincipal().getUsername() == post.author.username}"
                           th:text="수정"></a>
                        <form th:if="${@postService.canDelete(@rq.member, post)}"
                              th:action="@{|/post/delete/${post.id}|}" method="post">
                            <input type="hidden" name="_method" value="DELETE">
                            <button type="submit" class="btn btn-outline btn-sm mr-3"
                                    onclick="return confirm('정말로 삭제 하시겠습니까?');">삭제
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--댓글-->
    <h5 class="bg-blue-800 text-white px-4 py-3 my-2" th:text="|${#lists.size(post.commentList)}개의 답변이 있습니다.|"></h5>
    <div>
        <ul>
            <li th:each="comment : ${post.commentList}">
                <div class="card w-96 bg-base-100 shadow-xl mt-3 w-full">
                    <!--수정 일시-->
                    <div class="card-body">
                        <p th:text="${comment.content}"></p>
                        <div class="flex justify-end">
                            <div th:if="${comment.modifyDate != null}" class="badge badge-ghost dark:text-gray-300 p-2">
                                <div class="mr-2">modified at</div>
                                <div th:text="${#temporals.format(comment.modifyDate, 'yyyy-MM-dd HH:mm')}"></div>
                            </div>
                        </div>
                        <!--유저명+작성 일시-->
                        <div class=" flex justify-end">
                            <div class="badge badge-ghost dark:text-gray-300 p-2">
                                <div class="mr-2">
                                    <span th:if="${comment.author != null}" th:text="${comment.author.username}"></span>
                                </div>
                                <div>
                                    <div th:text="${#temporals.format(comment.createDate, 'yyyy-MM-dd HH:mm')}"></div>
                                </div>
                            </div>
                        </div>
                        <!--추천,수정,삭제 버튼-->
                        <div class="my-3 flex justify-between">
                            <div>
                                <div>
                                    <form method="post" class="like btn btn-sm btn-ghost"
                                          th:action="@{|/comment/${comment.id}/like|}">
                                        <button type="submit" onclick="return confirm('댓글을 추천 하시겠습니까?');">
                                            <i class="fa-regular fa-heart fa-xl"></i>
                                            <span class="badge rounded-pill bg-error"
                                                  th:text="${#lists.size(comment.voter)}"></span>
                                        </button>
                                    </form>
                                    <form method="post" class="deleteLike btn btn-sm btn-ghost"
                                          th:action="@{|/comment/${comment.id}/cancelLike|}">
                                        <input type="hidden" name="_method" value="DELETE">
                                        <button type="submit" onclick="return confirm('댓글 추천을 취소 하시겠습니까?');">
                                            <i class="fa-solid fa-heart-crack fa-xl"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                            <div class="flex justify-colum">
                                <a th:href="@{|/comment/modify/${comment.id}|}" class="btn btn-outline btn-sm mr-3"
                                   sec:authorize="isAuthenticated()"
                                   th:if="${comment.author != null and #authentication.getPrincipal().getUsername() == comment.author.username}"
                                   th:text="수정"></a>
                                <form th:if="${@commentService.canDelete(@rq.member, comment)}"
                                      th:action="@{|/comment/delete/${comment.id}|}" method="post">
                                    <input type="hidden" name="_method" value="DELETE">
                                    <button type="submit" class="btn btn-outline btn-sm mr-3"
                                            onclick="return confirm('정말로 삭제 하시겠습니까?');">삭제
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </div>

    <div class="mt-3 mx-3">

        <form th:action="@{|/comment/create/${post.id}|}" th:object="${commentForm}" method="post">
            <textarea class=" textarea textarea-bordered w-full" rows="3" id="content" name="content"></textarea>
            <div class="mt-3 flex justify-end">
                <input type="submit" value="댓글 등록" class="btn btn-outline btn-primary mr-3">
            </div>
        </form>
    </div>
</div>


</html>